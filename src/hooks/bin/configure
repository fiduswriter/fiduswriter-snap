#!/usr/bin/env python3
import os
from subprocess import call, check_call

SNAP_NAME = os.environ.get('SNAP_NAME')
SNAP = os.environ.get('SNAP')
SNAP_DATA = os.environ.get('SNAP_DATA')
CONFIGURE_PATH = '/var/snap/{}/current/configuration.py'.format(SNAP_NAME)

if __name__ == '__main__':
    os.environ["PATH"] += (
        ':{}/bin'.format(SNAP)
    )
    os.environ["PYTHONPATH"] = '{}/lib/python3.6/site-packages'.format(SNAP)
    if not os.path.isfile(CONFIGURE_PATH):
        call([
            '{}/bin/fiduswriter'.format(SNAP),
            'startproject',
            '--pythonpath',
            SNAP_DATA
        ])
    check_call([
        '{}/bin/fiduswriter'.format(SNAP),
        'setup',
        '--pythonpath',
        SNAP_DATA
    ])
    # Configuration options are to be
    # manually edited in configuration.py.
    call(['snapctl', 'restart', 'fiduswriter.daemon'])
